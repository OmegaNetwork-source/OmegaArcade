<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Omega Arcade Entry</title>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:700,400&display=swap" rel="stylesheet">
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: 'Montserrat', Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .arcade-container {
      background: #181818;
      border-radius: 24px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      padding: 40px 32px 32px 32px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 340px;
      max-width: 95vw;
    }
    .arcade-image {
      width: 180px;
      margin-bottom: 24px;
      filter: grayscale(1) contrast(1.2) brightness(1.2);
    }
    .omega-title {
      display: flex;
      align-items: baseline;
      justify-content: center;
      font-size: 3.2rem;
      font-weight: 900;
      letter-spacing: 0.12em;
      margin-bottom: 8px;
      text-align: center;
      color: #fff;
      text-shadow: 0 0 24px #fff, 0 0 4px #fff;
      gap: 0.08em;
    }
    .omega-symbol {
      font-family: 'Montserrat', Arial, sans-serif;
      font-weight: 900;
      font-size: 1.15em;
      line-height: 1;
      margin-right: 0.04em;
      display: inline-block;
      vertical-align: baseline;
    }
    .omega-text {
      display: inline-block;
      vertical-align: baseline;
    }
    .credits {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 48px;
      min-width: 140px;
      padding: 0 28px;
      font-size: 1.1rem;
      font-weight: 700;
      background: #222;
      border-radius: 8px;
      box-shadow: 0 0 16px #fff, 0 0 2px #fff;
      color: #fff;
      margin: 0;
    }
    .wallet-section, .deposit-section {
      width: 100%;
      margin-bottom: 18px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .wallet-btn, .deposit-btn, .enter-btn {
      background: #fff;
      color: #111;
      border: none;
      border-radius: 8px;
      padding: 12px 28px;
      font-size: 1.1rem;
      font-weight: 700;
      margin-top: 10px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    .wallet-btn:disabled, .deposit-btn:disabled, .enter-btn:disabled {
      background: #444;
      color: #aaa;
      cursor: not-allowed;
    }
    .game-select {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: none;
      font-size: 1.1rem;
      margin-bottom: 24px;
      background: #222;
      color: #fff;
      font-weight: 600;
    }
    .footer {
      margin-top: 32px;
      font-size: 0.95rem;
      color: #888;
      text-align: center;
    }
    .arcade-machine {
      margin-top: 32px;
      display: flex;
      justify-content: center;
      width: 320px;
      height: 420px;
      position: relative;
    }
    .arcade-frame {
      width: 100%;
      height: 100%;
      border-radius: 24px 24px 32px 32px;
      background: #111;
      box-shadow: 0 0 24px 4px #fff, 0 0 64px 8px #fff2, 0 0 0 8px #fff inset;
      border: 4px solid #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      position: relative;
      padding-top: 32px;
    }
    .arcade-screen {
      width: 240px;
      height: 160px;
      background: #222;
      border-radius: 10px;
      box-shadow: 0 0 24px 4px #fff, 0 0 0 4px #fff4 inset;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      margin: 0 auto;
      margin-bottom: 18px;
      overflow: hidden;
    }
    .screen-img {
      width: 100%;
      height: 100px;
      object-fit: cover;
      margin-bottom: 4px;
      filter: grayscale(1) contrast(1.1) brightness(1.2);
    }
    .screen-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: #fff;
      text-shadow: 0 0 12px #fff, 0 0 2px #fff;
      margin-bottom: 8px;
    }
    .play-btn {
      background: #fff;
      color: #111;
      border: none;
      border-radius: 6px;
      padding: 8px 32px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 0 16px #fff, 0 0 2px #fff;
      transition: background 0.2s, color 0.2s;
      margin-bottom: 8px;
    }
    .play-btn:disabled {
      background: #444;
      color: #aaa;
      cursor: not-allowed;
      box-shadow: none;
    }
    .arcade-controls {
      width: 100%;
      display: flex;
      flex-direction: row;
      align-items: flex-end;
      justify-content: center;
      margin-top: 18px;
      position: absolute;
      bottom: 24px;
      left: 0;
    }
    .joystick {
      width: 36px;
      height: 36px;
      background: #111;
      border-radius: 50%;
      border: 4px solid #fff;
      box-shadow: 0 0 16px 4px #fff, 0 0 0 8px #fff4 inset;
      margin-right: 32px;
      position: relative;
    }
    .joystick::after {
      content: '';
      position: absolute;
      left: 50%;
      top: 50%;
      width: 10px;
      height: 18px;
      background: #fff;
      border-radius: 5px;
      transform: translate(-50%, -120%);
      box-shadow: 0 0 8px #fff;
    }
    .buttons {
      display: flex;
      flex-direction: row;
      gap: 16px;
    }
    .button.neon-btn {
      width: 28px;
      height: 28px;
      background: #fff;
      border-radius: 50%;
      box-shadow: 0 0 16px 4px #fff, 0 0 0 4px #fff4 inset;
      border: 2px solid #fff;
      margin-top: 8px;
    }
    .arcade-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 32px;
      margin-top: 40px;
      width: 100%;
      max-width: 1200px;
      justify-items: center;
    }
    .arcade-machine {
      margin-top: 0;
      margin-bottom: 0;
      min-width: 320px;
      max-width: 340px;
      min-height: 420px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    @media (max-width: 900px) {
      .arcade-grid {
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 18px;
      }
      .arcade-machine {
        min-width: 220px;
        max-width: 98vw;
        min-height: 260px;
      }
    }
    @media (max-width: 700px) {
      .wallet-panel {
        top: 0;
        right: 0;
        left: 0;
        width: 100vw;
        min-width: unset;
        border-radius: 0 0 18px 18px;
        justify-content: center;
        padding: 8px 2vw;
        box-sizing: border-box;
      }
      .wallet-info {
        margin-right: 8px;
      }
      .wallet-action-btn {
        padding: 7px 14px;
        font-size: 0.98rem;
      }
      .arcade-actions-panel {
        max-width: 98vw;
        padding: 12px 2vw 12px 2vw;
        border-radius: 12px;
        gap: 10px;
      }
      .arcade-actions-row {
        flex-direction: column;
        gap: 8px;
        margin-bottom: 6px;
      }
      .credits, .free-play-btn {
        width: 100%;
        min-width: unset;
        max-width: unset;
        height: 48px;
        font-size: 1.08rem;
        border-radius: 10px;
      }
    }
    @media (max-width: 500px) {
      .arcade-container {
        padding: 8px 0 8px 0;
        min-width: unset;
        width: 100vw;
        border-radius: 0;
      }
      .arcade-grid {
        grid-template-columns: 1fr;
        gap: 12px;
        margin-top: 16px;
        width: 100vw;
        max-width: 100vw;
        padding: 0 2vw;
        box-sizing: border-box;
      }
      .arcade-machine {
        min-width: unset;
        max-width: 100vw;
        width: 100vw;
        height: auto;
        min-height: 220px;
      }
      .arcade-frame {
        padding-top: 8px;
        border-radius: 12px 12px 18px 18px;
      }
      .arcade-screen {
        width: 92vw;
        height: 80px;
      }
      .screen-title {
        font-size: 1rem;
      }
      .play-btn {
        font-size: 1rem;
        padding: 8px 18px;
      }
      .arcade-controls-up {
        margin-top: 6px;
      }
      .joystick {
        width: 16px;
        height: 16px;
        margin-right: 8px;
      }
      .button.neon-btn {
        width: 12px;
        height: 12px;
      }
      .credits {
        font-size: 1rem;
        padding: 8px 12px;
      }
      .omega-title {
        font-size: 2rem;
      }
    }
    html, body {
      max-width: 100vw;
      overflow-x: hidden;
    }
    .wallet-panel {
      position: fixed;
      top: 24px;
      right: 32px;
      z-index: 100;
      display: flex;
      align-items: center;
      background: rgba(24,24,24,0.85);
      border-radius: 18px;
      box-shadow: 0 4px 32px #0ff4, 0 2px 12px #0008;
      padding: 18px 28px;
      gap: 18px;
      backdrop-filter: blur(6px);
      min-width: 340px;
    }
    .wallet-info {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-right: 18px;
    }
    .wallet-status {
      font-size: 1.15rem;
      font-weight: 700;
      color: #fff;
      letter-spacing: 0.04em;
      margin-bottom: 2px;
      text-shadow: 0 0 16px #fff, 0 0 2px #fff;
    }
    .wallet-address {
      font-size: 1rem;
      color: #fff;
      font-family: monospace;
      opacity: 0.85;
    }
    .wallet-action-btn {
      background: #fff;
      color: #111;
      border: none;
      border-radius: 8px;
      padding: 10px 24px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 0 16px #fff, 0 0 2px #fff;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      margin-left: 0;
    }
    .wallet-action-btn:hover {
      background: #fff;
      color: #000;
      box-shadow: 0 0 32px #fff, 0 0 8px #fff;
    }
    .arcade-controls-up {
      position: static;
      margin-top: 12px;
      margin-bottom: 0;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      width: 100%;
    }
    .arcade-frame {
      position: relative;
    }
    .arcade-controls {
      /* Keep for legacy, but override with .arcade-controls-up */
      width: 100%;
      display: flex;
      flex-direction: row;
      align-items: flex-end;
      justify-content: center;
      margin-top: 18px;
      position: absolute;
      bottom: 24px;
      left: 0;
    }
    .bushido-machine .arcade-frame {
      box-shadow: 0 0 24px 4px #fff, 0 0 0 4px #e53935;
      border: 2px solid #e53935;
    }
    .free-play-label {
      color: #e53935;
      font-weight: bold;
      font-size: 1.1em;
      margin-bottom: 6px;
      text-shadow: 0 0 8px #fff, 0 0 2px #e53935;
    }
    .token-label {
      color: #fff;
      font-weight: bold;
      font-size: 1.1em;
      margin-bottom: 6px;
      text-shadow: 0 0 8px #fff, 0 0 2px #fff;
    }
    .omega-man-machine .arcade-frame {
      box-shadow: 0 0 24px 4px #fff, 0 0 0 4px #ffe600;
      border: 2px solid #ffe600;
    }
    .flappy-omega-machine .arcade-frame {
      box-shadow: 0 0 24px 4px #fff, 0 0 0 4px #00bfff;
      border: 2px solid #00bfff;
    }
    .omega-invaders-machine .arcade-frame {
      box-shadow: 0 0 24px 4px #fff, 0 0 0 4px #00ff6a;
      border: 2px solid #00ff6a;
    }
    .omega-pong-machine .arcade-frame {
      box-shadow: 0 0 24px 4px #fff, 0 0 0 4px #a259ff;
      border: 2px solid #a259ff;
    }
    .space-omega-machine .arcade-frame {
      box-shadow: 0 0 24px 4px #fff, 0 0 0 4px #00fff7;
      border: 2px solid #00fff7;
    }
    .omega-breaker-machine .arcade-frame {
      box-shadow: 0 0 24px 4px #fff, 0 0 0 4px #ff9100;
      border: 2px solid #ff9100;
    }
    .omega-io-machine .arcade-frame {
      box-shadow: 0 0 24px 4px #fff, 0 0 0 4px #ff4fd8;
      border: 2px solid #ff4fd8;
    }
    .free-play-section {
      width: 100%;
      margin-bottom: 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .free-play-btn {
      background: #fff;
      color: #111;
      border: none;
      border-radius: 8px;
      padding: 12px 28px;
      font-size: 1.1rem;
      font-weight: 700;
      margin-top: 10px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      box-shadow: 0 0 16px #fff, 0 0 2px #fff;
      text-transform: none;
      letter-spacing: normal;
    }
    .free-play-btn:disabled {
      background: #444;
      color: #aaa;
      cursor: not-allowed;
      box-shadow: none;
    }
    .free-play-btn.active {
      background: #4caf50;
      color: #fff;
      box-shadow: 0 0 24px #4caf50, 0 0 8px #4caf50;
    }
    .free-play-btn.active:hover {
      box-shadow: 0 0 32px #4caf50, 0 0 16px #4caf50;
    }
    .free-play-note {
      font-size: 0.9rem;
      color: #aaa;
      text-align: center;
      font-style: italic;
      margin-top: 4px;
    }
    .arcade-actions-panel {
      width: 100%;
      max-width: 400px;
      margin: 0 auto 32px auto;
      background: rgba(34,34,34,0.92);
      border-radius: 18px;
      box-shadow: 0 2px 24px #0008, 0 0 0 2px #fff2;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 24px 18px 18px 18px;
      gap: 14px;
    }
    .arcade-actions-row {
      width: 100%;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 18px;
      margin-bottom: 8px;
    }
    .credits, .free-play-btn {
      flex: 1 1 0;
      min-width: 160px;
      max-width: 240px;
      height: 54px;
      font-size: 1.2rem;
      font-weight: 700;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0;
      box-sizing: border-box;
    }
    .free-play-btn {
      margin: 0;
      box-shadow: 0 0 16px #fff, 0 0 2px #fff;
      border: none;
      transition: background 0.2s, color 0.2s;
    }
    .free-play-btn.active {
      background: #4caf50;
      color: #fff;
      box-shadow: 0 0 24px #4caf50, 0 0 8px #4caf50;
    }
  </style>
</head>
<body>
  <div class="wallet-panel">
    <div class="wallet-info">
      <span class="wallet-status" id="walletStatus">Wallet Not Connected</span>
      <span class="wallet-address" id="walletAddress" style="display:none;"></span>
    </div>
    <button class="wallet-action-btn" id="walletBtn">Connect Wallet</button>
    <button class="wallet-action-btn" id="disconnectBtn" style="display:none;">Disconnect Wallet</button>
  </div>
  <div class="arcade-container">
    <img src="insert-arcade.png" alt="Insert ARCADE" class="arcade-image" onerror="this.style.display='none'">
    <h1 class="omega-title">
      <span class="omega-symbol">&#937;</span><span class="omega-text">mega Arcade</span>
    </h1>
    <div class="arcade-actions-panel">
      <div class="arcade-actions-row">
        <div class="credits" id="creditsDisplay">Credits: 0</div>
        <button class="free-play-btn" id="freePlayBtn">Free Play</button>
      </div>
      <div class="deposit-section">
        <button class="deposit-btn" id="depositBtn">Insert 5 Tokens</button>
        <div id="depositStatus" style="margin-top:8px;font-size:0.95rem;color:#aaa;"></div>
      </div>
      <div class="free-play-note">Free Play doesn't accumulate points</div>
    </div>
    <div class="arcade-grid">
      <div class="arcade-machine bushido-machine" data-game="bushido">
        <div class="arcade-frame">
          <div class="arcade-screen">
            <img src="bushido-screenshot.png" alt="Bushido Clan Battle" class="screen-img" onerror="this.style.display='none'">
            <div class="screen-title">Bushido Clan Battle</div>
            <div class="free-play-label">Free Play</div>
            <button class="play-btn" data-url="https://game-pi-rosy.vercel.app/">Play</button>
          </div>
          <div class="arcade-controls-up">
            <div class="joystick"></div>
            <div class="buttons">
              <div class="button neon-btn"></div>
              <div class="button neon-btn"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="arcade-machine omega-man-machine" data-game="omega-man">
        <div class="arcade-frame">
          <div class="arcade-screen">
            <img src="omega-man-screenshot.png" alt="Omega-Man" class="screen-img" onerror="this.style.display='none'">
            <div class="screen-title">Omega-Man</div>
            <div class="token-label">5 Tokens</div>
            <button class="play-btn" data-url="https://omega-man.vercel.app/">Play</button>
          </div>
          <div class="arcade-controls-up">
            <div class="joystick"></div>
            <div class="buttons">
              <div class="button neon-btn"></div>
              <div class="button neon-btn"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="arcade-machine flappy-omega-machine" data-game="flappy-omega">
        <div class="arcade-frame">
          <div class="arcade-screen">
            <img src="flappy-omega-screenshot.png" alt="Flappy Omega" class="screen-img" onerror="this.style.display='none'">
            <div class="screen-title">Flappy Omega</div>
            <div class="token-label">5 Tokens</div>
            <button class="play-btn" data-url="flappy-omega.html">Play</button>
          </div>
          <div class="arcade-controls-up">
            <div class="joystick"></div>
            <div class="buttons">
              <div class="button neon-btn"></div>
              <div class="button neon-btn"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="arcade-machine omega-invaders-machine" data-game="omega-invaders">
        <div class="arcade-frame">
          <div class="arcade-screen">
            <img src="omega-invaders-screenshot.png" alt="Omega Invaders" class="screen-img" onerror="this.style.display='none'">
            <div class="screen-title">Omega Invaders</div>
            <div class="token-label">5 Tokens</div>
            <button class="play-btn" data-url="/omega-invaders.html">Play</button>
          </div>
          <div class="arcade-controls-up">
            <div class="joystick"></div>
            <div class="buttons">
              <div class="button neon-btn"></div>
              <div class="button neon-btn"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="arcade-machine omega-pong-machine" data-game="omega-pong">
        <div class="arcade-frame">
          <div class="arcade-screen">
            <img src="omega-pong-screenshot.png" alt="Omega Pong" class="screen-img" onerror="this.style.display='none'">
            <div class="screen-title">Omega Pong</div>
            <div class="token-label">5 Tokens</div>
            <button class="play-btn" data-url="/omega-pong.html">Play</button>
          </div>
          <div class="arcade-controls-up">
            <div class="joystick"></div>
            <div class="buttons">
              <div class="button neon-btn"></div>
              <div class="button neon-btn"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="arcade-machine space-omega-machine" data-game="space-omega">
        <div class="arcade-frame">
          <div class="arcade-screen">
            <img src="space-omega-screenshot.png" alt="Space Omega" class="screen-img" onerror="this.style.display='none'">
            <div class="screen-title">Space Omega</div>
            <div class="token-label">5 Tokens</div>
            <button class="play-btn" data-url="/space-omega.html">Play</button>
          </div>
          <div class="arcade-controls-up">
            <div class="joystick"></div>
            <div class="buttons">
              <div class="button neon-btn"></div>
              <div class="button neon-btn"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="arcade-machine omega-breaker-machine" data-game="omega-breaker">
        <div class="arcade-frame">
          <div class="arcade-screen">
            <img src="omega-breaker-screenshot.png" alt="Omega Breaker" class="screen-img" onerror="this.style.display='none'">
            <div class="screen-title">Omega Breaker</div>
            <div class="token-label">5 Tokens</div>
            <button class="play-btn" data-url="/omega-breaker.html">Play</button>
          </div>
          <div class="arcade-controls-up">
            <div class="joystick"></div>
            <div class="buttons">
              <div class="button neon-btn"></div>
              <div class="button neon-btn"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="arcade-machine omega-io-machine" data-game="omega-io">
        <div class="arcade-frame">
          <div class="arcade-screen">
            <img src="omega-io-screenshot.png" alt="Omega.IO" class="screen-img" onerror="this.style.display='none'">
            <div class="screen-title">Omega.IO</div>
            <div class="token-label">5 Tokens</div>
            <button class="play-btn" data-url="/omega-io.html">Play</button>
          </div>
          <div class="arcade-controls-up">
            <div class="joystick"></div>
            <div class="buttons">
              <div class="button neon-btn"></div>
              <div class="button neon-btn"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="footer">
    Powered by ARCADE Token &bull; Omega Network<br>
    <span style="font-size:0.85em;">Deposit ARCADE tokens to play for points, or use Free Play for unlimited games (no points).</span>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script>
    // --- Config ---
    const CREDITS_PER_DEPOSIT = 1; // 1 ARCADE = 1 credit
    const ARCADE_TOKEN_ADDRESS = '0xFF3fD61427d3485c8e33cb5f5999EAd9639C56a5';
    const ARCADE_DEPOSIT_ADDRESS = '0xA27F8d05b33486785B2cff6D6A0BDe9269c68607';
    const ARCADE_DECIMALS = 18;
    const ARCADE_SYMBOL = 'ARCADE';
    // --- State ---
    let userAddress = null;
    let credits = 0;
    let freePlayMode = false;
    // --- Elements ---
    const walletBtn = document.getElementById('walletBtn');
    const walletAddressDiv = document.getElementById('walletAddress');
    const walletStatus = document.getElementById('walletStatus');
    const disconnectBtn = document.getElementById('disconnectBtn');
    const depositBtn = document.getElementById('depositBtn');
    const depositStatus = document.getElementById('depositStatus');
    const creditsDisplay = document.getElementById('creditsDisplay');
    const playBtn = document.getElementById('playBtn');
    const freePlayBtn = document.getElementById('freePlayBtn');
    // --- Load State ---
    function loadState() {
      userAddress = localStorage.getItem('omega_arcade_wallet') || null;
      credits = parseInt(localStorage.getItem('omega_arcade_credits') || '0', 10);
      freePlayMode = localStorage.getItem('omega_arcade_freeplay') === 'true';
      updateUI();
    }
    function saveState() {
      if (userAddress) localStorage.setItem('omega_arcade_wallet', userAddress);
      localStorage.setItem('omega_arcade_credits', credits);
      localStorage.setItem('omega_arcade_freeplay', freePlayMode);
    }
    // --- UI Update ---
    function updateUI() {
      creditsDisplay.textContent = `Credits: ${credits}`;
      if (userAddress) {
        walletStatus.textContent = 'Wallet Connected';
        walletBtn.style.display = 'none';
        walletAddressDiv.style.display = 'inline-block';
        walletAddressDiv.textContent = userAddress.slice(0,6) + '...' + userAddress.slice(-4);
        disconnectBtn.style.display = 'inline-block';
      } else {
        walletStatus.textContent = 'Wallet Not Connected';
        walletBtn.style.display = 'inline-block';
        walletAddressDiv.style.display = 'none';
        disconnectBtn.style.display = 'none';
      }
      
      // Update free play button
      if (freePlayMode) {
        freePlayBtn.textContent = 'Free Play Active';
        freePlayBtn.classList.add('active');
      } else {
        freePlayBtn.textContent = 'Free Play';
        freePlayBtn.classList.remove('active');
      }
      
      updatePlayButtons();
    }
    // --- Wallet Connect ---
    walletBtn.onclick = async function() {
      if (window.ethereum) {
        try {
          const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
          userAddress = accounts[0];
          saveState();
          updateUI();
        } catch (e) {
          alert('Wallet connection rejected.');
        }
      } else {
        alert('MetaMask or compatible wallet not found.');
      }
    };
    // --- Deposit ---
    depositBtn.onclick = async function() {
      if (!userAddress) {
        alert('Connect your wallet first.');
        return;
      }
      const amount = 5;
      depositBtn.disabled = true;
      depositStatus.textContent = 'Waiting for MetaMask...';
      try {
        if (!window.ethereum) throw new Error('MetaMask not found');
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const signer = provider.getSigner();
        const arcadeToken = new ethers.Contract(
          ARCADE_TOKEN_ADDRESS,
          [
            'function transfer(address to, uint256 amount) public returns (bool)'
          ],
          signer
        );
        const tx = await arcadeToken.transfer(
          ARCADE_DEPOSIT_ADDRESS,
          ethers.utils.parseUnits(amount.toString(), ARCADE_DECIMALS)
        );
        depositStatus.textContent = 'Waiting for confirmation...';
        await tx.wait();
        credits += amount * CREDITS_PER_DEPOSIT;
        saveState();
        updateUI();
        depositStatus.textContent = `Deposited ${amount} ${ARCADE_SYMBOL}. (+${amount*CREDITS_PER_DEPOSIT} credits)`;
      } catch (e) {
        depositStatus.textContent = 'Deposit failed: ' + (e.message || e);
      }
      depositBtn.disabled = false;
    };
    // --- Arcade Play Buttons ---
    function updatePlayButtons() {
      document.querySelectorAll('.play-btn').forEach(btn => {
        const machine = btn.closest('.arcade-machine');
        if (machine && machine.dataset.game === 'bushido') {
          btn.disabled = false;
          btn.classList.remove('disabled');
        } else if (freePlayMode) {
          btn.disabled = false;
          btn.classList.remove('disabled');
        } else {
          btn.disabled = !(userAddress && credits >= 5);
        }
      });
    }
    document.querySelectorAll('.play-btn').forEach(btn => {
      btn.onclick = function() {
        const machine = btn.closest('.arcade-machine');
        if (machine && machine.dataset.game === 'bushido') {
          window.location.href = btn.getAttribute('data-url');
        } else if (freePlayMode) {
          window.location.href = btn.getAttribute('data-url');
        } else if (userAddress && credits >= 5) {
          credits -= 5;
          saveState();
          window.location.href = btn.getAttribute('data-url');
        }
      };
    });
    // --- Disconnect Wallet ---
    disconnectBtn.onclick = function() {
      userAddress = null;
      freePlayMode = false;
      localStorage.removeItem('omega_arcade_wallet');
      credits = 0;
      localStorage.setItem('omega_arcade_credits', credits);
      localStorage.setItem('omega_arcade_freeplay', false);
      updateUI();
    };
    // --- Free Play ---
    freePlayBtn.onclick = function() {
      if (!userAddress) {
        alert('Connect your wallet first.');
        return;
      }
      freePlayMode = !freePlayMode;
      if (freePlayMode) {
        credits = 0; // Reset credits when entering free play
        alert('Free Play activated! All games are now free to play. Points will not accumulate.');
      } else {
        alert('Free Play deactivated. You can now deposit tokens to play for points.');
      }
      saveState();
      updateUI();
    };
    // --- Init ---
    loadState();
  </script>
</body>
</html> 
